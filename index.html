<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>p5 Whiteboard</title>

  <!-- External libs (DEFER for deterministic order) -->
  <script defer src="https://cdn.jsdelivr.net/npm/p5@1.9.2/lib/p5.min.js"></script>

  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: {
        packages: { '[+]': ['ams'] },
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']]
      },
      svg: { fontCache: 'global' }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <link rel="stylesheet" href="styles.css"/>
</head>

<body>

  <!-- ===== Toolbar (MUST exist for ui.js) ===== -->
  <div id="ui" class="partial">
    <div id="dragHandle" title="Drag toolbar">
      <div class="dots" aria-hidden="true">
        <span></span><span></span><span></span>
        <span></span><span></span><span></span>
      </div>

      <div class="handleBtns">
        <div class="shortcutWrap">
          <button id="btnShortcuts" class="miniBtn" title="Shortcuts">âŒ¨</button>
          <div id="shortcutCard"></div>
        </div>

        <button id="btnDark" class="miniBtn" title="Toggle dark mode">
          <span id="glyphDark">ğŸŒ™</span>
        </button>

        <button id="btnCycle" class="miniBtn" title="Cycle toolbar">
          <span id="glyphCycle">â–¾</span>
        </button>
      </div>
    </div>

    <!-- CORE -->
    <div class="core">
      <button class="tool" id="toolPen"><span class="ico">âœ</span><span>Pen</span></button>
      <button class="tool" id="toolEraser"><span class="ico">ğŸ§½</span><span>Eraser</span></button>
      <button class="tool" id="toolHighlighter" title="Highlighter (line)">
        <span class="ico">ğŸ–ï¸</span><span>Highlighter</span>
      </button>

      <select id="shapeTool" title="Shapes">
        <option value="" disabled selected>â—¯  Shapes</option>
        <option value="line">â€”  Line</option>
        <option value="arrow">â¤  Arrow</option>
        <option value="circle">â—¯  Circle</option>
        <option value="rect">â–­  Rect</option>
        <option value="ellipse">â¬­  Ellipse (e=0.9)</option>
      </select>

      <div class="color-select" id="colorSelect" title="Color">
        <div class="color-left">
          <div class="chip" id="colorChip"></div>
          <div class="label">ğŸ¨ Color</div>
        </div>
        <div class="caret">â–¾</div>
        <div class="palette" id="palette">
          <div class="palette-grid" id="paletteGrid"></div>
        </div>
      </div>
    </div>

    <!-- ADVANCED -->
    <div class="advanced">
      <select id="strokeWidth" title="Line width"></select>
      <select id="smoothing" title="Free draw line smoothing (1 = none)"></select>
      <select id="transp" title="Transparency (1=opaque, 10=almost invisible)"></select>

      <button class="tool" id="toolFill" title="Fill (uses selected Color + Transp.)">
        <span class="ico">ğŸª£</span><span>Fill</span>
      </button>

      <button class="tool" id="toolText" title="Text tool">
        <span class="ico">T</span><span>Text / LaTeX</span>
      </button>

      <button class="tool" id="toolLaser" title="Laser (uses current color + width)">
        <span class="ico red">â—</span><span>Laser</span>
      </button>

      <button class="tool" id="toolLasso" title="Lasso select & transform">
        <span class="ico">âŸ²</span><span>Lasso</span>
      </button>

      <select id="bgMode" title="Background (G)">
        <option value="transparent" selected>â–¦  Bg: transp.</option>
        <option value="dots">â€¢  Bg: dots</option>
        <option value="grid">â§‰  Bg: grid</option>
      </select>

      <label class="pill" title="Snap to grid (N)">
        <input id="snap" type="checkbox" />
        âŒ—  Snap
      </label>

      <div class="layers-select" id="layersSelect"
           title="Click: select layer. Click same layer again: toggle visibility.">
        <div id="layersLabel" class="label">ğŸ§± Layers</div>
        <div class="caret">â–¾</div>
        <div class="layers-menu" id="layersMenu"></div>
      </div>

      <button class="action" id="undo" title="Undo (active layer)">
        <span class="ico">â†¶</span><span>Undo</span>
      </button>

      <button class="action" id="clear" title="Clear active layer (undoable)">
        <span class="ico">ğŸ—‘</span><span>Clear layer</span>
      </button>

      <button id="btnSaveJson" title="Save drawing as .wb.json">Save...</button>
      <button id="btnOpenJson" title="Open a .wb.json drawing">Open...</button>
      <input id="fileOpenJson" type="file" accept=".json,.wb.json,application/json" style="display:none" />
    </div>
  </div>

  <!-- ===== Text editor popup (MUST exist for text.js/ui.js) ===== -->
  <div id="textEditor">
    <div id="textEditorTop">
      <div id="textEditorTitle">Enter text (LaTex syntax supported)</div>
      <select id="textSizeEditor" title="Font size"></select>
    </div>
    <textarea id="textInput" spellcheck="false"></textarea>
    <div id="textHint">e.g. <code>velocity $v_x$</code>. Ctrl+Enter = commit. Esc = cancel.</div>
  </div>

  <!-- ===== Canvas + overlays ===== -->
  <div id="canvas-wrap"></div>
  <div id="canvas-outline"></div>
  <div id="text-overlay"></div>
  <div id="cursorHint"></div>
  <div id="toast"></div>

  <!-- ===== App modules (DEFER, ordered) ===== -->
  <script defer src="config.js"></script>
  <script defer src="state.js"></script>
  <script defer src="utils.js"></script>
  <script defer src="ui.js"></script>
  <script defer src="drawing.js"></script>
  <script defer src="lasso.js"></script>
  <script defer src="text.js"></script>
  <script defer src="storage.js"></script>
  <script defer src="io.js"></script>
  <script defer src="app.js"></script>

</body>
</html>
